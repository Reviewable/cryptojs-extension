/*
 * The MIT License
 *
 * (MIT)Copyright (c) 2015 artjomb
 */
!function(a,b,c){"function"==typeof define&&define.amd?define(["crypto-js/core","crypto-js/aes","crypto-js/mode-ctr"],b):b(a.CryptoJS)}(this,function(a){function b(b,c){var d=f.createEncryptor(b,{iv:e.create(),padding:a.pad.NoPadding}),g=d.finalize(c);return g}var c;c=a.hasOwnProperty("ext")?a.ext:a.ext={},c.bitshift=function(a,b){var c,d,e=0,f=a.words,g=0;if(b>0){for(;b>31;)f.splice(0,1),f.push(0),b-=32,g++;if(0==b)return e;for(var h=f.length-g-1;h>=0;h--)c=f[h],f[h]<<=b,f[h]|=e,e=c>>>32-b}else if(b<0){for(;b<-31;)f.splice(0,0,0),f.length--,b+=32,g++;if(0==b)return e;b=-b,d=(1<<b)-1;for(var h=g;h<f.length;h++)c=f[h]&d,f[h]>>>=b,f[h]|=e,e=c<<32-b}return e},c.neg=function(a){for(var b=a.words,c=0;c<b.length;c++)b[c]=~b[c];return a},c.xor=function(a,b){for(var c=0;c<a.words.length;c++)a.words[c]^=b.words[c];return a},c.bitand=function(a,b){for(var c=a.clone(),d=c.words,e=b.words,f=0;f<d.length;f++)d[f]&=e[f];return c};var c;c=a.hasOwnProperty("ext")?a.ext:a.ext={};var d=a.lib.Base,e=a.lib.WordArray;c.const_Zero=e.create([0,0,0,0]),c.const_One=e.create([0,0,0,1]),c.const_Rb=e.create([0,0,0,135]),c.const_Rb_Shifted=e.create([2147483648,0,0,67]),c.const_nonMSB=e.create([4294967295,4294967295,2147483647,2147483647]),c.isWordArray=function(a){return a&&"function"==typeof a.clamp&&"function"==typeof a.concat&&"array"==typeof a.words},a.pad.OneZeroPadding={pad:function(a,b){for(var c=4*b,d=c-a.sigBytes%c,f=[],g=0;g<d;g+=4){var h=0;0===g&&(h=2147483648),f.push(h)}var i=e.create(f,d);a.concat(i)},unpad:function(){}},a.pad.NoPadding={pad:function(){},unpad:function(){}},c.leftmostBytes=function(a,b){var c=a.clone();return c.sigBytes=b,c.clamp(),c},c.rightmostBytes=function(a,b){a.clamp();var d=32,e=a.clone(),f=8*(e.sigBytes-b);if(f>=d){var g=Math.floor(f/d);f-=g*d,e.words.splice(0,g),e.sigBytes-=g*d/8}return f>0&&(c.bitshift(e,f),e.sigBytes-=f/8),e},c.popWords=function(a,b){var d=c.leftmostBytes(a,4*b);return a.words=a.words.slice(b),a.sigBytes-=4*b,d},c.shiftBytes=function(a,b){b=b||16;var d=b%4;b-=d;for(var f=e.create(),g=0;g<b;g+=4)f.words.push(a.words.shift()),a.sigBytes-=4,f.sigBytes+=4;return d>0&&(f.words.push(a.words[0]),f.sigBytes+=d,c.bitshift(a,8*d),a.sigBytes-=d),f},c.xorendBytes=function(a,b){return c.leftmostBytes(a,a.sigBytes-b.sigBytes).concat(c.xor(c.rightmostBytes(a,b.sigBytes),b))},c.dbl=function(a){var b=c.msb(a);return c.bitshift(a,1),c.xor(a,1===b?c.const_Rb:c.const_Zero),a},c.inv=function(a){var b=1&a.words[4];return c.bitshift(a,-1),c.xor(a,1===b?c.const_Rb_Shifted:c.const_Zero),a},c.equals=function(a,b){if(!b||!b.words||a.sigBytes!==b.sigBytes)return!1;a.clamp(),b.clamp();for(var c=0,d=0;d<a.words.length;d++)c|=a.words[d]^b.words[d];return 0===c},c.msb=function(a){return a.words[0]>>>31};var d=a.lib.Base,e=a.lib.WordArray,f=a.algo.AES,c=a.ext,g=a.pad.OneZeroPadding,h=a.algo.CMAC=d.extend({init:function(a){var d=b(a,c.const_Zero),e=d.clone();if(c.dbl(e),this._isTwo){var f=d.clone();c.inv(f)}else{var f=e.clone();c.dbl(f)}this._K1=e,this._K2=f,this._K=a,this._const_Bsize=16,this.reset()},reset:function(){this._x=c.const_Zero.clone(),this._counter=0,this._buffer=e.create()},update:function(d){if(!d)return this;var e=this._buffer,f=this._const_Bsize;for("string"==typeof d&&(d=a.enc.Utf8.parse(d)),e.concat(d);e.sigBytes>f;){var g=c.shiftBytes(e,f);c.xor(this._x,g),this._x.clamp(),this._x=b(this._K,this._x),this._counter++}return this},finalize:function(a){this.update(a);var d=this._buffer,e=this._const_Bsize,f=d.clone();return d.sigBytes===e?c.xor(f,this._K1):(g.pad(f,e/4),c.xor(f,this._K2)),c.xor(f,this._x),this.reset(),b(this._K,f)},_isTwo:!1});a.CMAC=function(a,b){return h.create(a).finalize(b)},a.algo.OMAC1=h,a.algo.OMAC2=h.extend({_isTwo:!0});var d=a.lib.Base,e=a.lib.WordArray,f=a.algo.AES,c=a.ext,h=a.algo.CMAC,i=e.create([0,0,0,0]),j=e.create([0,0,0,1]),k=e.create([0,0,0,2]),l=16;a.EAX=d.extend({init:function(a,b){var d;if(b&&b.splitKey){var e=Math.floor(a.sigBytes/2);d=c.shiftBytes(a,e)}else d=a.clone();this._ctrKey=a,this._mac=h.create(d),this._tagLen=b&&b.tagLength||l,this.reset()},reset:function(){this._mac.update(j),this._ctr&&this._ctr.reset()},updateAAD:function(a){return this._mac.update(a),this},initCrypt:function(b,d){var g=this;return g._tag=g._mac.finalize(),g._isEnc=b,g._mac.update(i),d=g._mac.finalize(d),c.xor(g._tag,d),g._ctr=f.createEncryptor(g._ctrKey,{iv:d,mode:a.mode.CTR,padding:a.pad.NoPadding}),g._buf=e.create(),g._mac.update(k),g},update:function(b){"string"==typeof b&&(b=a.enc.Utf8.parse(b));var d=this,f=d._buf,g=d._isEnc;f.concat(b);var h=g?f.sigBytes:Math.max(f.sigBytes-d._tagLen,0),i=h>0?c.shiftBytes(f,h):e.create(),j=d._ctr.process(i);return d._mac.update(g?j:i),j},finalize:function(a){var b=this,d=a?b.update(a):e.create(),f=b._mac,g=b._ctr.finalize();if(b._isEnc){var h=f.finalize(g);return c.xor(b._tag,h),b.reset(),d.concat(g).concat(b._tag)}var h=f.finalize();return c.xor(b._tag,h),b.reset(),!!c.equals(b._tag,b._buf)&&d.concat(g)},encrypt:function(a,b,c){var d=this;return c&&Array.prototype.forEach.call(c,function(a){d.updateAAD(a)}),d.initCrypt(!0,b),d.finalize(a)},decrypt:function(a,b,c){var d=this;return c&&Array.prototype.forEach.call(c,function(a){d.updateAAD(a)}),d.initCrypt(!1,b),d.finalize(a)}})});